version: 1.0.{build}
image: Visual Studio 2013
configuration: Release
platform:
- x86
- x64
environment:
  THRIFT_EXE_PATH: C:\projects\fmu\thrift-0.10.0.exe
  THRIFT_DIR: C:\projects\fmu\thrift-0.10.0\lib\cpp
  BOOST_ROOT: C:\Libraries\boost\
  BOOST_LIB_32: C:\Libraries\boost\lib32-msvc-12.0
  BOOST_LIB_64: C:\Libraries\boost\lib64-msvc-12.0
install:
- ps: Start-FileDownload  http://archive.apache.org/dist/thrift/0.10.0/thrift-0.10.0.tar.gz
- ps: Start-FileDownload  http://archive.apache.org/dist/thrift/0.10.0/thrift-0.10.0.exe
- cmd: 7z x thrift-0.10.0.tar.gz -so | 7z x -si -ttar > nul
- ps: (Get-Content thrift-0.10.0\lib\cpp\3rdparty.props) | ForEach-Object { $_ -replace "\`$\(THIRD_PARTY\)\\boost\\boost_1_47_0", "C:\Libraries\boost\" } | Set-Content thrift-0.10.0\lib\cpp\3rdparty.props
- ps: (Get-Content thrift-0.10.0\lib\cpp\libthrift.vcxproj) | select-string -pattern 'Include=.*TSSLSocket\.' -notmatch | Set-Content thrift-0.10.0\lib\cpp\libthrift.vcxproj
- ps: >-
   $xml = [xml](Get-Content thrift-0.10.0\lib\cpp\libthrift.vcxproj)
   
   $node = $xml.Project
   
   $node.ToolsVersion= "12.0"
   
   foreach($PropertyGroup in $xml.Project.PropertyGroup){
      if ($PropertyGroup.Label  -eq 'Configuration'){
         $newChild = $xml.CreateElement("PlatformToolset","http://schemas.microsoft.com/developer/msbuild/2003") 
         
         $newChild.set_InnerXML("v120") 
         
         $PropertyGroup.AppendChild($newChild) 
      }
   }
   $xml.OuterXml | Set-Content thrift-0.10.0\lib\cpp\libthrift.vcxproj
   
- cmd: echo "install done"
build:
  project: ril/Ril.sln
  verbosity: minimal
